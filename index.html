<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Conduit Fill Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 1em;
    }
    table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
      padding: 4px;
    }
    table {
      width: 100%;
      margin-bottom: 1em;
    }
    th {
      background-color: #f2f2f2;
    }
    .hidden {
      display: none;
    }
    .btn {
      margin-top: 1em;
    }
  </style>
</head>
<body>

  <h2>Conduit Fill Calculator (Electrical Only)</h2>

  <label for="usageType"><strong>Select Application:</strong></label>
  <select id="usageType" onchange="toggleTables()">
    <option value="electrical">Electrical</option>
  </select>

  <label for="conduitType"><strong>Conduit Type:</strong></label>
  <select id="conduitType">
    <option value="PVC">PVC</option>
    <option value="EMT">EMT</option>
  </select>

  <div id="electricalSection">
    <h3>Electrical Wires</h3>
    <table id="electricalTable">
      <thead>
        <tr>
          <th>Quantity</th>
          <th>Conductor Size</th>
          <th>Insulation Type</th>
          <th>Area (in²)</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
    <button onclick="addElectricalRow()">Add Electrical Row</button>
  </div>

  <div id="result" class="btn"></div>
  <button onclick="updateTotals()" class="btn">Calculate</button>

  <script>
    const wireSizes = {
      "14 AWG": { THW: 0.0133, THHN: 0.0124 },
      "12 AWG": { THW: 0.0200, THHN: 0.0166 },
      "10 AWG": { THW: 0.0314, THHN: 0.0269 },
      "8 AWG":  { THW: 0.0507, THHN: 0.0453 },
      "6 AWG":  { THW: 0.0851, THHN: 0.0749 },
      "4 AWG":  { THW: 0.1333, THHN: 0.1158 },
      "3 AWG":  { THW: 0.1534, THHN: 0.1309 },
      "2 AWG":  { THW: 0.1901, THHN: 0.1636 },
      "1 AWG":  { THW: 0.2426, THHN: 0.2071 },
      "1/0 AWG":{ THW: 0.3047, THHN: 0.2598 },
      "2/0 AWG":{ THW: 0.3617, THHN: 0.3160 },
      "3/0 AWG":{ THW: 0.4258, THHN: 0.3768 },
      "4/0 AWG":{ THW: 0.5095, THHN: 0.4442 },
      "250 kcmil": { THW: 0.5856, THHN: 0.5082 },
      "300 kcmil": { THW: 0.6775, THHN: 0.5817 },
      "350 kcmil": { THW: 0.7658, THHN: 0.6551 },
      "400 kcmil": { THW: 0.8597, THHN: 0.7265 },
      "500 kcmil": { THW: 1.0460, THHN: 0.8646 },
      "600 kcmil": { THW: 1.2256, THHN: 1.0100 },
      "750 kcmil": { THW: 1.5163, THHN: 1.2200 }
    };

    const conduitSizes = {
      EMT: [
        { size: '1/2"', maxFill: 0.122 },
        { size: '3/4"', maxFill: 0.213 },
        { size: '1"', maxFill: 0.346 },
        { size: '1 1/4"', maxFill: 0.598 },
        { size: '1 1/2"', maxFill: 0.832 },
        { size: '2"', maxFill: 1.342 },
        { size: '2 1/2"', maxFill: 2.313 },
        { size: '3"', maxFill: 3.356 },
        { size: '3 1/2"', maxFill: 4.360 },
        { size: '4"', maxFill: 5.456 }
      ],
      PVC: [
        { size: '1/2"', maxFill: 0.136 },
        { size: '3/4"', maxFill: 0.242 },
        { size: '1"', maxFill: 0.407 },
        { size: '1 1/4"', maxFill: 0.684 },
        { size: '1 1/2"', maxFill: 0.997 },
        { size: '2"', maxFill: 1.624 },
        { size: '2 1/2"', maxFill: 2.772 },
        { size: '3"', maxFill: 3.833 },
        { size: '3 1/2"', maxFill: 5.058 },
        { size: '4"', maxFill: 6.625 }
      ]
    };

    function addElectricalRow() {
      const table = document.querySelector("#electricalTable tbody");
      const row = table.insertRow();

      const qtyCell = row.insertCell();
      const sizeCell = row.insertCell();
      const insulationCell = row.insertCell();
      const areaCell = row.insertCell();

      qtyCell.innerHTML = `<input type="number" min="1" value="1" onchange="updateRowArea(this)">`;

      let sizeSelect = `<select onchange="updateRowArea(this)">`;
      for (let size in wireSizes) sizeSelect += `<option value="${size}">${size}</option>`;
      sizeSelect += `</select>`;
      sizeCell.innerHTML = sizeSelect;

      let insulationSelect = `<select onchange="updateRowArea(this)">`;
      insulationSelect += `<option value="THW">THW</option><option value="THHN">THHN</option>`;
      insulationSelect += `</select>`;
      insulationCell.innerHTML = insulationSelect;

      areaCell.className = "area";
      areaCell.textContent = "0.0000";

      updateRowArea(row);
    }

    function updateRowArea(elem) {
      const row = elem.closest("tr");
      const inputs = row.querySelectorAll("input");
      const selects = row.querySelectorAll("select");
      const count = parseInt(inputs[0].value) || 0;
      const wireSize = selects[0].value;
      const insulation = selects[1].value;
      const area = (wireSizes[wireSize] && wireSizes[wireSize][insulation]) || 0;
      const total = count * area;
      row.querySelector(".area").textContent = total.toFixed(4);
    }

    function toggleTables() {
      document.getElementById("electricalSection").classList.remove("hidden");
    }

    function updateTotals() {
      let totalArea = 0;
      let totalConductors = 0;

      document.querySelectorAll("#electricalTable tbody tr").forEach(row => {
        const count = parseInt(row.querySelector("input").value) || 0;
        const area = parseFloat(row.querySelector(".area").textContent) || 0;
        totalConductors += count;
        totalArea += area;
      });

      let fillRatio = totalConductors === 1 ? 0.53 : (totalConductors === 2 ? 0.31 : 0.40);
      const requiredArea = totalArea / fillRatio;
      const conduitType = document.getElementById("conduitType").value;
      const options = conduitSizes[conduitType] || [];

      let suggestedSize = "Not available";
      let actualFill = 0;
      for (let opt of options) {
        if (opt.maxFill >= requiredArea) {
          suggestedSize = `${opt.size} (Max Fill ${opt.maxFill} in²)`;
          actualFill = (totalArea / opt.maxFill) * 100;
          break;
        }
      }

      document.getElementById("result").innerHTML = `
        <strong>Total Conductors:</strong> ${totalConductors}<br>
        <strong>Total Area of Conductors:</strong> ${totalArea.toFixed(4)} in²<br>
        <strong>NEC Fill %:</strong> ${(fillRatio * 100).toFixed(0)}%<br>
        <strong>Required Area w/ Fill:</strong> ${requiredArea.toFixed(4)} in²<br>
        <strong>Suggested Conduit Size:</strong> ${suggestedSize}<br>
        <strong>Actual Fill Used:</strong> ${actualFill.toFixed(2)}%
      `;
    }

    addElectricalRow();
  </script>
</body>
</html>
