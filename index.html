<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Conduit Fill Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 800px;
      margin: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1em;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    th {
      background: #f2f2f2;
    }
    .btn {
      margin: 10px 0;
      padding: 10px 20px;
      background: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
    }
    .btn:hover {
      background: #45a049;
    }
    .result-box {
      margin-top: 20px;
      padding: 15px;
      border: 1px solid #ccc;
      background: #f9f9f9;
    }
  </style>
</head>
<body>

<h2>Conduit Fill Calculator</h2>

<label for="conduitType"><strong>Conduit Type:</strong></label>
<select id="conduitType">
  <option value="PVC">PVC</option>
  <option value="EMT">EMT</option>
</select>

<table id="wireTable">
  <thead>
    <tr>
      <th>Quantity</th>
      <th>Wire Size</th>
      <th>Insulation</th>
      <th>Area (in²)</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<button class="btn" onclick="addRow()">Add Wire</button>
<button class="btn" onclick="calculateFill()">Calculate</button>

<div id="result" class="result-box"></div>

<script>
  const wireSizes = {
    "14 AWG": { THW: 0.0133, THHN: 0.0124 },
    "12 AWG": { THW: 0.0200, THHN: 0.0166 },
    "10 AWG": { THW: 0.0314, THHN: 0.0269 },
    "8 AWG":  { THW: 0.0507, THHN: 0.0453 },
    "6 AWG":  { THW: 0.0851, THHN: 0.0749 },
    "4 AWG":  { THW: 0.1333, THHN: 0.1158 },
    "3 AWG":  { THW: 0.1534, THHN: 0.1309 },
    "2 AWG":  { THW: 0.1901, THHN: 0.1636 },
    "1 AWG":  { THW: 0.2426, THHN: 0.2071 },
    "1/0 AWG":{ THW: 0.3047, THHN: 0.2598 },
    "2/0 AWG":{ THW: 0.3617, THHN: 0.3160 },
    "3/0 AWG":{ THW: 0.4258, THHN: 0.3768 },
    "4/0 AWG":{ THW: 0.5095, THHN: 0.4442 },
    "250 kcmil": { THW: 0.5856, THHN: 0.5082 },
    "300 kcmil": { THW: 0.6775, THHN: 0.5817 },
    "350 kcmil": { THW: 0.7658, THHN: 0.6551 },
    "400 kcmil": { THW: 0.8597, THHN: 0.7265 },
    "500 kcmil": { THW: 1.0460, THHN: 0.8646 },
    "600 kcmil": { THW: 1.2256, THHN: 1.0100 },
    "750 kcmil": { THW: 1.5163, THHN: 1.2200 }
  };

  const conduitSizes = {
    EMT: [
      { size: '1/2"', maxFill: 0.122 },
      { size: '3/4"', maxFill: 0.213 },
      { size: '1"', maxFill: 0.346 },
      { size: '1 1/4"', maxFill: 0.598 },
      { size: '1 1/2"', maxFill: 0.832 },
      { size: '2"', maxFill: 1.342 },
      { size: '2 1/2"', maxFill: 2.313 },
      { size: '3"', maxFill: 3.356 },
      { size: '3 1/2"', maxFill: 4.360 },
      { size: '4"', maxFill: 5.456 }
    ],
    PVC: [
      { size: '1/2"', maxFill: 0.136 },
      { size: '3/4"', maxFill: 0.242 },
      { size: '1"', maxFill: 0.407 },
      { size: '1 1/4"', maxFill: 0.684 },
      { size: '1 1/2"', maxFill: 0.997 },
      { size: '2"', maxFill: 1.624 },
      { size: '2 1/2"', maxFill: 2.772 },
      { size: '3"', maxFill: 3.833 },
      { size: '3 1/2"', maxFill: 5.058 },
      { size: '4"', maxFill: 6.625 }
    ]
  };

  function addRow() {
    const tbody = document.querySelector("#wireTable tbody");
    const row = tbody.insertRow();

    const qty = row.insertCell();
    qty.innerHTML = `<input type="number" min="1" value="1" onchange="updateArea(this)">`;

    const size = row.insertCell();
    const insulation = row.insertCell();
    const area = row.insertCell();
    area.className = "area";

    let sizeOptions = "<select onchange='updateArea(this)'>";
    for (let s in wireSizes) sizeOptions += `<option value="${s}">${s}</option>`;
    sizeOptions += "</select>";
    size.innerHTML = sizeOptions;

    let insulOptions = "<select onchange='updateArea(this)'>";
    insulOptions += `<option value="THW">THW</option><option value="THHN">THHN</option>`;
    insulOptions += "</select>";
    insulation.innerHTML = insulOptions;

    area.textContent = "0.0000";

    updateArea(row);
  }

  function updateArea(elem) {
    const row = elem.closest("tr");
    const qty = parseInt(row.querySelector("input").value) || 0;
    const size = row.querySelectorAll("select")[0].value;
    const insul = row.querySelectorAll("select")[1].value;
    const area = (wireSizes[size] && wireSizes[size][insul]) || 0;
    const total = qty * area;
    row.querySelector(".area").textContent = total.toFixed(4);
  }

  function calculateFill() {
    const conduitType = document.getElementById("conduitType").value;
    const rows = document.querySelectorAll("#wireTable tbody tr");

    let totalConductors = 0;
    let totalArea = 0;

    rows.forEach(row => {
      const qty = parseInt(row.querySelector("input").value) || 0;
      const area = parseFloat(row.querySelector(".area").textContent) || 0;
      totalConductors += qty;
      totalArea += area;
    });

    const fillPercent = totalConductors === 1 ? 0.53 : (totalConductors === 2 ? 0.31 : 0.40);
    const requiredArea = totalArea / fillPercent;

    const sizes = conduitSizes[conduitType];
    let suggestion = "Not Found";
    let actualFill = 0;

    for (const s of sizes) {
      if (s.maxFill >= requiredArea) {
        suggestion = `${s.size} (Max Fill ${s.maxFill} in²)`;
        actualFill = (totalArea / s.maxFill) * 100;
        break;
      }
    }

    document.getElementById("result").innerHTML = `
      <strong>Total Conductors:</strong> ${totalConductors}<br>
      <strong>Total Wire Area:</strong> ${totalArea.toFixed(4)} in²<br>
      <strong>Max Fill % per Code:</strong> ${(fillPercent * 100).toFixed(0)}%<br>
      <strong>Required Area (incl. fill):</strong> ${requiredArea.toFixed(4)} in²<br>
      <strong>Suggested Conduit Size:</strong> ${suggestion}<br>
      <strong>Actual Fill Used:</strong> ${actualFill.toFixed(2)}%
    `;
  }

  addRow();
</script>
</body>
</html>
