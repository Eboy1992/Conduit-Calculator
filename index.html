<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Conduit Sizing Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f4f8;
      padding: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
    }
    th, td {
      padding: 8px;
      border: 1px solid #ccc;
    }
    input, select, button {
      padding: 6px;
    }
    #result {
      margin-top: 20px;
      padding: 10px;
      background: #fff9c4;
      border: 1px solid #fbc02d;
      border-radius: 5px;
    }
  </style>
</head>
<body>

  <h2>Conduit Sizing Calculator</h2>

  <table id="conductorTable">
    <thead>
      <tr>
        <th>Quantity</th>
        <th>Wire Size</th>
        <th>Insulation Type</th>
        <th>Total Area (in²)</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <button onclick="addRow()">Add Conductor</button>

  <div id="result"></div>

  <script>
    const wireAreas = {
      "14 AWG(2.5 mm2)": { THW: 0.0139, THHN: 0.0097, RHW: 0.0293, XHHW: 0.0139 },
      "12 AWG(3.5 mm2)": { THW: 0.0206, THHN: 0.0133, RHW: 0.0314, XHHW: 0.0206 },
      "10 AWG(5.5 mm2)": { THW: 0.0333, THHN: 0.0211, RHW: 0.0509, XHHW: 0.0333 },
      "8 AWG(8.0 mm2)": { THW: 0.0531, THHN: 0.0366, RHW: 0.0810, XHHW: 0.0531 },
      "6 AWG(14 mm2)": { THW: 0.0824, THHN: 0.0507, RHW: 0.1227, XHHW: 0.0824 },
      "4 AWG(22 mm2)": { THW: 0.1321, THHN: 0.0824, RHW: 0.1924, XHHW: 0.1321 },
      "2 AWG(38 mm2)": { THW: 0.2143, THHN: 0.1307, RHW: 0.2909, XHHW: 0.2143 },
      "1/0 AWG(53.5 mm2)": { THW: 0.3308, THHN: 0.2067, RHW: 0.4442, XHHW: 0.3308 },
      "3/0 AWG(85 mm2)": { THW: 0.5222, THHN: 0.3278, RHW: 0.6885, XHHW: 0.5222 },
      "250 Kcmill": { THW: 0.7371, THHN: 0.5663, RHW: 0.9318, XHHW: 0.7393 },
      "500 Kcmill": { THW: 1.4375, THHN: 1.1543, RHW: 1.7719, XHHW: 1.4522 },
      "1000 Kcmill": { THW: 1.4784, THHN: 1.3478, RHW: 1.7719, XHHW: 1.3519 }
    };

    const conduitSizes = [
      { size: '1/2"', maxFill: 0.314 },
      { size: '3/4"', maxFill: 0.549 },
      { size: '1"', maxFill: 0.887 },
      { size: '1-1/4"', maxFill: 1.526 },
      { size: '1-1/2"', maxFill: 2.071 },
      { size: '2"', maxFill: 3.408 },
      { size: '2-1/2"', maxFill: 4.866 },
      { size: '3"', maxFill: 7.499 },
      { size: '3-1/2"', maxFill: 10.010 },
      { size: '4"', maxFill: 12.882 },
      { size: '5"', maxFill: 20.212 },
      { size: '6"', maxFill: 29.158 }
    ];

    function addRow() {
      const tbody = document.querySelector('#conductorTable tbody');
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><input type="number" min="1" value="1" onchange="updateTotals()"></td>
        <td>
          <select onchange="updateTotals()">
            ${Object.keys(wireAreas).map(size => `<option value="${size}">${size}</option>`).join("")}
          </select>
        </td>
        <td>
          <select onchange="updateTotals()">
            <option value="THW">THW</option>
            <option value="THHN">THHN</option>
            <option value="RHW">RHW</option>
            <option value="XHHW">XHHW</option>
          </select>
        </td>
        <td class="area">0.0000</td>
        <td><button onclick="this.closest('tr').remove(); updateTotals();">Delete</button></td>
      `;
      tbody.appendChild(tr);
      updateTotals();
    }

    function updateTotals() {
      let totalArea = 0;
      let totalCount = 0;
      const rows = document.querySelectorAll('#conductorTable tbody tr');

      rows.forEach(row => {
        const qty = parseInt(row.cells[0].querySelector('input').value) || 0;
        const size = row.cells[1].querySelector('select').value;
        const insulation = row.cells[2].querySelector('select').value;
        const area = (wireAreas[size]?.[insulation] || 0) * qty;
        row.querySelector('.area').textContent = area.toFixed(4);
        totalArea += area;
        totalCount += qty;
      });

      // Fill percentage per NEC
      let fillPercent = totalCount === 1 ? 0.53 : totalCount === 2 ? 0.31 : 0.40;
      const requiredArea = totalArea / fillPercent;

      const minConduit = conduitSizes.find(c => requiredArea <= c.maxFill);
      const resultText = minConduit 
        ? `Minimum Conduit Size Required: <strong>${minConduit.size}</strong> (Max fill: ${minConduit.maxFill} in²)`
        : "No suitable conduit size found.";

      document.getElementById('result').innerHTML = `
        <strong>Total Conductor Area:</strong> ${totalArea.toFixed(4)} in²<br>
        <strong>Conductor Count:</strong> ${totalCount}<br>
        <strong>Allowed Fill %:</strong> ${(fillPercent * 100).toFixed(0)}%<br>
        <strong>Required Area (Adjusted for Fill):</strong> ${requiredArea.toFixed(4)} in²<br>
        ${resultText}
      `;
    }

    addRow(); // Add initial row
  </script>

</body>
</html>
